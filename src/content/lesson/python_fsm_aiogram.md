---
title: 'Диалоги в aiogram'
description: 'Создание диалогов в боте при помощи FSM'
draft: true
slug: '7af810c1-acd8-48ea-b821-33cd1457f4c3'
order: 5
---

##### Вступление

Все мы встречались с различными формами на сайтах:

<form>
    <input type="text" placeholder="Ваше имя">
    <input type="number" placeholder="Ваш возраст" min="10" max="100">
    <label>
        Ваш пол:
        <select>
            <option>Мужской</option>
            <option>Женский</option>
        </select>
    <label>
        Ваш любимый жанр художественной литературы:
        <select>
            <option>Фантастика</option>
            <option>Детектив</option>
        </select>
    </label>
    <input type="text" placeholder="Ваш любимый автор">
</form>

Форма выше - просто пример некоего опроса по книгам. Вообще формы разного рода часто используют для целей:
- регистрации
- заполнения профиля или анкеты
- опросов 
- тестов 
- обратной связи 
- отзывов
- оформления заказов и т.д.

В Telegram форму не создать, поэтому когда требуется собрать данные, делают это при помощи диалогов и механизма,
который называют FSM. Все разбивается на отдельные вопросы, которые задает бот, и ответы от пользователя на 
каждый вопрос бота проверяются и сохраняются.

![схема диалога](/python/5_2.png)

Так выглядит диалог схематически, на каждом шаге задается вопрос и после ожидается ответ от пользователя.
Для некоторых ответов предусмотрена проверка, точно так же как и на сайтах.

##### Основа диалога

Для того, чтобы создать диалог в aiogram, в первую очередь продумывают, какие данные нужно будет получать от пользователя,
и создают класс, вмещающий в себе "состояния", каждое из которых будет отвечать за один вопрос бота. В моем случае
я буду спрашивать имя пользователя, возраст, пол, любимый жанр и автора. Вот как это выглядит в коде:
```python
from aiogram.fsm.state import State, StatesGroup
from aiogram.fsm.context import FSMContext


class BookSurvey(StatesGroup):
    name = State()
    age = State()
    gender = State()
    genre = State()
    author = State()
```

Каждое сотояние - это поле в классе BookSurvey.
Первый обработчик - для запуска диалога и вопроса "Как вас зовут?".
```python
@router.message(Command('opros'))
async def start_survey(message: types.Message, state: FSMContext):
    await state.set_state(BookSurvey.name)
    await message.answer('Как вас зовут?')
```
Тип аргумента `state` - `FSMContext`, название `state` не должно меняться. Он отвечает за работу FSM: 
переключением состояний и сохранением данных. 
